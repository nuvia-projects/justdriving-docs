"use strict";(globalThis.webpackChunkjustdriving=globalThis.webpackChunkjustdriving||[]).push([[3208],{2259:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"data/indexing","title":"Indexing Strategies","description":"This page describes the general indexing strategy used in the Just Driving database and highlights important patterns to follow when adding new tables or queries. The goal is to keep read and write performance acceptable as data grows, especially around bookings, invoices, and notifications.","source":"@site/docs/data/indexing.md","sourceDirName":"data","slug":"/data/indexing","permalink":"/docs/data/indexing","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/data/indexing.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Data Flow Diagrams","permalink":"/docs/data/flow"},"next":{"title":"Permissions Matrix","permalink":"/docs/category/permissions-matrix"}}');var t=i(4848),r=i(8453);const a={sidebar_position:5},d="Indexing Strategies",o={},l=[{value:"General principles",id:"general-principles",level:2},{value:"Foreign key and relationship indexes",id:"foreign-key-and-relationship-indexes",level:2},{value:"Time-based and status queries",id:"time-based-and-status-queries",level:2},{value:"High-traffic tables",id:"high-traffic-tables",level:2},{value:"Text and search fields",id:"text-and-search-fields",level:2},{value:"Adding indexes safely",id:"adding-indexes-safely",level:2}];function c(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"indexing-strategies",children:"Indexing Strategies"})}),"\n",(0,t.jsx)(n.p,{children:"This page describes the general indexing strategy used in the Just Driving database and highlights important patterns to follow when adding new tables or queries. The goal is to keep read and write performance acceptable as data grows, especially around bookings, invoices, and notifications."}),"\n",(0,t.jsx)(n.h2,{id:"general-principles",children:"General principles"}),"\n",(0,t.jsx)(n.p,{children:"The indexing approach in Just Driving follows a few simple rules:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Every table has a primary key (typically an auto\u2011incrementing ",(0,t.jsx)(n.code,{children:"id"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Foreign keys and join columns that participate in common ",(0,t.jsx)(n.code,{children:"WHERE"})," or ",(0,t.jsx)(n.code,{children:"JOIN"})," clauses are indexed."]}),"\n",(0,t.jsxs)(n.li,{children:["Composite indexes are added where queries frequently filter by more than one column (for example, ",(0,t.jsx)(n.code,{children:"notifiable_type"})," + ",(0,t.jsx)(n.code,{children:"notifiable_id"}),")."]}),"\n",(0,t.jsx)(n.li,{children:"Indexes are added to columns used for lookups and filtering, but avoided on columns that are frequently updated and not part of critical queries."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"When adding new features, think about which queries will run most often and index accordingly."}),"\n",(0,t.jsx)(n.h2,{id:"foreign-key-and-relationship-indexes",children:"Foreign key and relationship indexes"}),"\n",(0,t.jsx)(n.p,{children:"Relationship tables and foreign keys are some of the most important places to add indexes. Common patterns include:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Link tables"})," (for example, school\u2013teacher, school\u2013student, booking\u2013student, class\u2013student) should have indexes on both foreign key columns so joins and lookups are efficient."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Child tables"})," that belong to a parent via ",(0,t.jsx)(n.code,{children:"school_id"}),", ",(0,t.jsx)(n.code,{children:"teacher_id"}),", ",(0,t.jsx)(n.code,{children:"student_id"}),", or ",(0,t.jsx)(n.code,{children:"school_class_id"}),' should have indexes on these foreign keys, because queries often filter by "all rows for this school/teacher/student/class".']}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Pivot tables"})," that are used in many\u2011to\u2011many relationships should also have composite indexes on both sides of the relationship where appropriate."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"As a rule of thumb: if a column is used in joins or commonly used to filter by a parent entity, it should have an index."}),"\n",(0,t.jsx)(n.h2,{id:"time-based-and-status-queries",children:"Time-based and status queries"}),"\n",(0,t.jsx)(n.p,{children:"Many queries in Just Driving are time\u2011 or status\u2011based, for example:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Upcoming bookings for a given teacher or student."}),"\n",(0,t.jsx)(n.li,{children:"Recent invoices and payments."}),"\n",(0,t.jsx)(n.li,{children:"Recent notifications for a user."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"For these cases, consider:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Indexing ",(0,t.jsx)(n.code,{children:"date"})," or ",(0,t.jsx)(n.code,{children:"datetime"})," columns that are frequently used in ",(0,t.jsx)(n.code,{children:"WHERE"})," clauses (e.g. ",(0,t.jsx)(n.code,{children:"date_from"}),", ",(0,t.jsx)(n.code,{children:"date_to"}),", ",(0,t.jsx)(n.code,{children:"due_date"}),", ",(0,t.jsx)(n.code,{children:"created_at"})," when used with a parent key)."]}),"\n",(0,t.jsxs)(n.li,{children:["Combining a foreign key with a status or date in a composite index if queries often filter by both (for example, ",(0,t.jsx)(n.code,{children:"school_id + status"}),", or ",(0,t.jsx)(n.code,{children:"teacher_id + date_from"}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:'The general pattern is to support queries of the form "give me all X for this Y in this time range" with an appropriate index.'}),"\n",(0,t.jsx)(n.h2,{id:"high-traffic-tables",children:"High-traffic tables"}),"\n",(0,t.jsx)(n.p,{children:"Some tables naturally receive more reads/writes and benefit from careful indexing:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Bookings and booking\u2013student links"}),(0,t.jsx)(n.br,{}),"\n","These tables are central for scheduling and are often queried by school, teacher, student, and date range. Ensure lookups by ",(0,t.jsx)(n.code,{children:"school_id"}),", ",(0,t.jsx)(n.code,{children:"teacher_id"}),", ",(0,t.jsx)(n.code,{children:"student_id"}),", and relevant date/status fields are efficient."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Invoices, invoice items, payments, and student balances"}),(0,t.jsx)(n.br,{}),"\n","These are used in financial reports and student account overviews. Queries often involve ",(0,t.jsx)(n.code,{children:"school_id"}),", ",(0,t.jsx)(n.code,{children:"student_id"}),", ",(0,t.jsx)(n.code,{children:"due_date"}),", and ",(0,t.jsx)(n.code,{children:"date_payed"}),". Indexes on these fields (and combinations) keep financial pages responsive."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Notifications and logs"}),(0,t.jsx)(n.br,{}),"\n","If the system stores notification records or audit logs and often filters by ",(0,t.jsx)(n.code,{children:"notifiable_type"}),", ",(0,t.jsx)(n.code,{children:"notifiable_id"}),", and ",(0,t.jsx)(n.code,{children:"read_at"}),"/",(0,t.jsx)(n.code,{children:"created_at"}),", composite indexes on these columns improve performance."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"When you add new high-traffic features, monitor which queries run most often (for example via query logs) and adjust indexes based on real usage."}),"\n",(0,t.jsx)(n.h2,{id:"text-and-search-fields",children:"Text and search fields"}),"\n",(0,t.jsx)(n.p,{children:"Free\u2011text fields (for example, notes, long descriptions) are usually not indexed, unless a specific search feature requires them to be."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'For simple "contains" searches across small datasets, no special index might be necessary.'}),"\n",(0,t.jsxs)(n.li,{children:["For larger search or full\u2011text search needs, consider using:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"MySQL full\u2011text indexes (where supported) on selected columns, or"}),"\n",(0,t.jsx)(n.li,{children:"Offloading search to a dedicated search engine (not covered here)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Avoid adding normal B\u2011tree indexes to large text columns unless you know they are needed."}),"\n",(0,t.jsx)(n.h2,{id:"adding-indexes-safely",children:"Adding indexes safely"}),"\n",(0,t.jsx)(n.p,{children:"When adding new indexes:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Prefer adding them via migrations so changes are tracked and reproducible."}),"\n",(0,t.jsx)(n.li,{children:"Be aware that adding indexes on very large tables can temporarily lock the table or impact performance in production."}),"\n",(0,t.jsx)(n.li,{children:"Where possible, test new indexes in a staging environment with realistic data volume before applying them in production."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>d});var s=i(6540);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);